# ๐ฎ๐ท ุฑุงูููุง ูุตุจ ู ุฑุงูโุงูุฏุงุฒ ุณุฑูุฑ ฺฉุงูุงู (Conduit) ุจุง ูุงุฑูุงู ุงุฑุงู

ุงู ุฑุงูููุง ูุฑุงุญู ฺฉุงูู ุขูุงุฏูโุณุงุฒ ุณุฑูุฑุ ูุตุจ ฺฉุงูุงู (Conduit)ุ ู ูุนุงูโุณุงุฒ ูุงุฑูุงู ูุฎุตูุต ุงุฑุงู ุฑุง ุชูุถุญ ูโุฏูุฏ.

## ูุงุฒููุฏโูุง ุณุณุชู (System Requirements)

ูุจู ุงุฒ ุดุฑูุนุ ุงุทููุงู ุญุงุตู ฺฉูุฏ ุณุฑูุฑ ุดูุง ุญุฏุงูู ูุดุฎุตุงุช ุฒุฑ ุฑุง ุฏุงุฑุฏ:
- **ุณุณุชู ุนุงูู:** ูููฺฉุณ (Ubuntu 20.04+, Debian 10+, CentOS 8+, etc.)
- **ุฏุณุชุฑุณ:** ุฑูุช (Root) ุง ฺฉุงุฑุจุฑ ุจุง ุฏุณุชุฑุณ `sudo`
- **ุงูุชุฑูุช:** ุฏุณุชุฑุณ ุขุฒุงุฏ ุจู ุงูุชุฑูุช (ุจุฏูู ููุชุฑูฺฏ ุดุฏุฏ ุฏุฑ ุณูุช ุฏุชุงุณูุชุฑ)
- **ููุงุจุน ุณุฎุชโุงูุฒุงุฑ:**
  - ุญุฏุงูู RAM: ตฑฒ ูฺฏุงุจุงุช (ฑ ฺฏฺฏุงุจุงุช+ ุจุฑุง ฺูุฏู ฺฉุงูุชูุฑ ุชูุตู ูโุดูุฏ)
  - ุญุฏุงูู CPU: ฑ ูุณุชู

---

## ูพุดโูุงุฒูุง

ฑ. ูพูุดู `Config` ุฑุง ุจู ุณุฑูุฑ ุฎูุฏ ููุชูู ฺฉูุฏ (ูุซูุงู ุจุง SFTP ุง SCP).
ฒ. ูุงุฑุฏ ูพูุดู ุดูุฏ ู ุจู ุงุณฺฉุฑูพุชโูุง ูุฌูุฒ ุงุฌุฑุง ุจุฏูุฏ:

```bash
cd Config
chmod +x *.sh
```

---

## ูุฑุญูู ฑ: ุขูุงุฏูโุณุงุฒ ู ุงููโุณุงุฒ ุณุฑูุฑ (Server Hardening)

ุงู ุงุณฺฉุฑูพุช (`01_server_setup.sh`) ุจุฑุง ุขูุงุฏูโุณุงุฒ ฺฉ ุณุฑูุฑ ุฎุงู (Fresh Install) ุทุฑุงุญ ุดุฏู ุงุณุช. ุงุฌุฑุง ุขู ุจุฑุง ุงููุช ุณุฑูุฑ **ุญุงุช** ุงุณุช.

### ๐ฏ ูุฏู ู ฺฉุงุฑุจุฑุฏ
ุงู ุงุณฺฉุฑูพุช ฺฉุงุฑูุง ุฒุฑ ุฑุง ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุงูุฌุงู ูโุฏูุฏ:
- ุขูพุฏุช ฺฉุงูู ุณุณุชู ุนุงูู (Ubuntu Update/Upgrade)
- ูุตุจ ุงุจุฒุงุฑูุง ุถุฑูุฑ (ูุงููุฏ curl, git, htop, ...)
- ุชูุธู ูุงุฑูุงู (UFW) ู ุจุณุชู ุชูุงู ูพูุฑุชโูุง ุบุฑุถุฑูุฑ (ุจุฌุฒ SSH)
- ูุตุจ Fail2Ban ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุญููุงุช Brute Force ุฑู SSH
- ุชูุธู ุณุงุนุช ุณุฑูุฑ (Time Sync)
- ุงุฌุงุฏ Swap File (ุจุฑุง ุฌููฺฏุฑ ุงุฒ ฺฉู ุขูุฑุฏู ุฑู)

### ๐ฅ ฺู ฺฉุณุงู ุจุงุฏ ุงุฒ ุงู ุงุณฺฉุฑูพุช ุงุณุชูุงุฏู ฺฉููุฏุ
- ููู ฺฉุงุฑุจุฑุงู ฺฉู ุณุฑูุฑ ุฌุฏุฏ ุชูู ฺฉุฑุฏูโุงูุฏ.
- ฺฉุณุงู ฺฉู ูโุฎูุงููุฏ ุงููุช ุณุฑูุฑุดุงู ุฑุง ุจุฏูู ุฏุงูุด ูู ูพฺุฏู ุจุงูุง ุจุจุฑูุฏ.

ุฏุณุชูุฑ ุงุฌุฑุง:
```bash
sudo bash 01_server_setup.sh
```

### โ ุณูุงูุงุช ู ูุฑูุฏโูุง ุงู ูุฑุญูู:

ฑ. **ุดุฑูุน ูุตุจ:**
   > **Prompt:** `Continue? (y/n):`
   >
   > **ูพุงุณุฎ:** `y`
   >
   > ุชุงุฏ ูโฺฉูุฏ ฺฉู ุนููุงุช ูุตุจ ู ุงููโุณุงุฒ ุขุบุงุฒ ุดูุฏ.

ฒ. **ุณุฎุชโฺฏุฑ SSH (ููู):**
   > **Prompt:** `Apply SSH hardening? (y/n):`
   >
   > **ูพุงุณุฎ ูพุดููุงุฏ:** `n`
   >
   > **ุชูุถุญ:** ุงู ฺฏุฒูู ูุฑูุฏ ุจุง ุฑูุฒ ุนุจูุฑ (Password Login) ุฑุง ุบุฑูุนุงู ูโฺฉูุฏ ู ููุท ุงุฌุงุฒู ูุฑูุฏ ุจุง ฺฉูุฏ (SSH Key) ุฑุง ูโุฏูุฏ.
   > - ุงฺฏุฑ **ููโุฏุงูุฏ SSH Key ฺุณุช** ุง ูููุฒ ุขู ุฑุง ุฑู ุณุฑูุฑ ุณุช ูฺฉุฑุฏูโุงุฏุ ุญุชูุงู **`n`** ุจุฒูุฏ. ุฏุฑ ุบุฑ ุงู ุตูุฑุช ุฏุณุชุฑุณ ุดูุง ุจู ุณุฑูุฑ ูุทุน ุฎูุงูุฏ ุดุฏ!
   > - ุงฺฏุฑ ฺฉูุฏ ุนููู ุฎูุฏ ุฑุง ูุจูุงู ุฏุฑ `authorized_keys` ูุฑุงุฑ ุฏุงุฏูโุงุฏุ ูโุชูุงูุฏ ุจุฑุง ุงููุช ุจุดุชุฑ `y` ุจุฒูุฏ.

---

## ูุฑุญูู ฒ: ูุตุจ ฺฉุงูุงู (Conduit)

ุงู ุงุณฺฉุฑูพุช (`02_install_conduit.sh`) ูุณุฎู ุฑุณู Conduit Manager ุฑุง ุฏุงูููุฏ ู ุงุฌุฑุง ูโฺฉูุฏ. ุงู ูุฑุญูู ุฏุงุฑุง ุชูุธูุงุช ฺฉูุฏ ุจุฑุง ุจูููโุณุงุฒ ุนููฺฉุฑุฏ ุณุฑูุฑ ุดูุงุณุช.

ุฏุณุชูุฑ ุงุฌุฑุง:
```bash
sudo bash 02_install_conduit.sh
```

### ๐ ุฑุงูููุง ฺฏุงูโุจูโฺฏุงู ุณูุงูุงุช ูุตุจ:

ฑ. **ููู ุงุตู:**
   ฺฏุฒูู **`1`** (Install Conduit) ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.


2. **ุชูุธูุงุช ูพุดุฑูุชู (Configuration):**
   ุงุณฺฉุฑูพุช ุจุฑ ุงุณุงุณ ุณุฎุชโุงูุฒุงุฑ ุดูุง ูพุดููุงุฏุงุช ูโุฏูุฏ. ุฌุฏูู ุฒุฑ ุฑุงูููุง ุชูุธู ุฏุณุช ุงุณุช:

   | ูุณุชู CPU | ููุฏุงุฑ RAM | ุชุนุฏุงุฏ ฺฉุงูุชูุฑ ูพุดููุงุฏ | ุญุฏุงฺฉุซุฑ ฺฉุงุฑุจุฑ (Max Clients) |
   | :--- | :--- | :--- | :--- |
   | ฑ ูุณุชู | < ฑ ฺฏฺฏ | **ฑ** ฺฉุงูุชูุฑ | ฑฐฐ |
   | ฒ ูุณุชู | ฒ ฺฏฺฏ | **ฑ-ฒ** ฺฉุงูุชูุฑ | ฒฐฐ |
   | ด ูุณุชู | ด ฺฏฺฏ+ | **ฒ-ณ** ฺฉุงูุชูุฑ | ดฐฐ |
   | ธ+ ูุณุชู | ธ ฺฏฺฏ+ | **ณ-ต** ฺฉุงูุชูุฑ | ธฐฐ |

   **ุชูุถุญุงุช ฺฏุฒููโูุง:**
   > **Prompt:** `max-clients:`
   >
   > **ูพุดููุงุฏ:** ููุท **Enter** ุจุฒูุฏ ุชุง ููุฏุงุฑ ูพุดููุงุฏ (ูุญุงุณุจู ุดุฏู ุจุฑ ุงุณุงุณ CPU) ุงูุชุฎุงุจ ุดูุฏ.
   > *ูุฑููู:* ุจู ุงุฒุง ูุฑ ูุณุชู CPUุ ุญุฏูุฏ ฑฐฐ ฺฉุงุฑุจุฑ ููุฒูุงู ููุงุณุจ ุงุณุช.

   > **Prompt:** `Set unlimited bandwidth? [y/N]`
   >
   > **ูพุดููุงุฏ:** **`y`** (ูุงูุญุฏูุฏ)
   > *ุชูุถุญ:* ุงฺฏุฑ ูุญุฏูุฏุช ุชุฑุงูฺฉ ุฏุฑ ุณูุช ุฏุชุงุณูุชุฑ ูุฏุงุฑุฏุ ูพููุง ุจุงูุฏ ุฑุง ูุงูุญุฏูุฏ ุจฺฏุฐุงุฑุฏ ุชุง ุณุฑุนุช ฺฉุงุฑุจุฑุงู ฺฉุงูุด ูุงุจุฏ. ุงฺฏุฑ ูุญุฏูุฏุช ุฏุงุฑุฏุ `n` ุจุฒูุฏ ู ุณูพุณ ููุฏุงุฑ (ูุซูุงู 5 Mbps) ุฑุง ูุงุฑุฏ ฺฉูุฏ.

   > **Prompt:** `containers:`
   >
   > **ูพุดููุงุฏ:** ุนุฏุฏ ูพุดููุงุฏ ุงุณฺฉุฑูพุช ุฑุง ูุงุฑุฏ ฺฉูุฏ ุง **Enter** ุจุฒูุฏ.
   > *ูฺฉุชู:* ุงุฌุฑุง ุจุด ุงุฒ ุญุฏ ฺฉุงูุชูุฑ ุฑู ุณุฑูุฑ ุถุนู ุจุงุนุซ ฺฉูุฏ ุดุฏุฏ ูโุดูุฏ.

   > **Prompt:** `Proceed with these settings? [Y/n]`
   >
   > **ูพุงุณุฎ:** **`y`**

3. **ูพุงุงู ูุตุจ:**
   ูพุณ ุงุฒ ุชุงุฏุ ุฏุงฺฉุฑ ูุตุจ ุดุฏู ู ฺฉุงูุชูุฑูุง ุงุฌุฑุง ูโุดููุฏ. QR ฺฉุฏ ู ID ุณุฑูุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ. ฺฉูุฏ ูุฑ ุฏฺฉููโุง ุฑุง ุจุฒูุฏ ุชุง ุจู ููู ุงุตู ุจุฑฺฏุฑุฏุฏ ู ุณูพุณ **`0`** ุฑุง ุจุฑุง ุฎุฑูุฌ ุจุฒูุฏ.

---

## ูุฑุญูู ณ: ูุนุงูโุณุงุฒ ูุงุฑูุงู ุงุฑุงู (ุงุฎุชุงุฑ ูู ูพุดููุงุฏ)

ูพุดููุงุฏ ูุดูุฏ ุงู ูุฑุญูู ุฑุง ูพุณ ุงุฒ ุงุทููุงู ุงุฒ ุชุฑุงูฺฉ ฺฏุฑ ฺฉุงูุฏูุช ุงูุฌุงู ุฏูุฏ.


ุงู ุงุณฺฉุฑูพุช (`03_setup_iran_firewall.sh`) ฺฉ ูุงุฑูุงู ููุดููุฏ ูุตุจ ูโฺฉูุฏ ฺฉู ุชุฑุงูฺฉ UDP ุฑุง ููุท ุจู **IPูุง ุงุฑุงู** ูุญุฏูุฏ ูโฺฉูุฏุ ุงูุง ุชุฑุงูฺฉ TCP ุฑุง ุจุฑุง ุงุชุตุงู ุจู ุณุฑูุฑูุง ุฌูุงู (Global) ุจุงุฒ ูโฺฏุฐุงุฑุฏ. ุงู ฺฉุงุฑ ุจุงุนุซ ฺฉุงูุด ุญุณุงุณุช ููุชุฑูฺฏ ุฑู ุณุฑูุฑ ุดูุง ูโุดูุฏ.

ุฏุณุชูุฑ ุงุฌุฑุง:
```bash
sudo bash 03_setup_iran_firewall.sh
```

### ๐ ุฑุงูููุง ฺฏุงูโุจูโฺฏุงู ุณูุงูุงุช ูุงุฑูุงู:

ฑ. **ูุตุจ ุณุฑูุณ:**
   ุงุจุชุฏุง ุงุณฺฉุฑูพุช ูุงูโูุง ูุงุฒู ุฑุง ฺฉูพ ฺฉุฑุฏู ู ุณุฑูุณ `conduit-firewall` ุฑุง ุงุฌุงุฏ ูโฺฉูุฏ.

ฒ. **ูุนุงูโุณุงุฒ ุขู (Prompt Activation):**
   ุฏุฑ ูพุงุงู ูุตุจุ ุงุฒ ุดูุง ูพุฑุณุฏู ูโุดูุฏ:
   > **Prompt:** `Enable firewall? (y/n):`
   >
   > **ูพุดููุงุฏ:** **`y`**

ณ. **ููู ุงูุชุฎุงุจ ุญุงูุช (Mode Selection):**
   ูพุณ ุงุฒ ุชุงุฏุ ููู ุฒุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ:
   
   *   **ฺฏุฒูู ฑ - ูุนุงูโุณุงุฒ ุญุงูุช ุนุงุฏ (Enable Iran-only mode - Normal):** **(ูพุดููุงุฏ)**
       *   ุชุฑุงูฺฉ **TCP** (ูุซู ุงุชุตุงู ุจู ุจุฑูฺฉุฑูุง) ุจุงุฒ ูโูุงูุฏ ุชุง ุณุฑูุฑ ุดูุง ุชูุณุท ุดุจฺฉู ุฌูุงู ุดูุงุณุง ุดูุฏ.
       *   ุชุฑุงูฺฉ **UDP** (ุฏุชุง ุงุตู) ููุท ุจุฑุง ุงุฑุงู ุจุงุฒ ุงุณุช.
   
   *   **ฺฏุฒูู ฒ - ูุนุงูโุณุงุฒ ุญุงูุช ุณุฎุชโฺฏุฑุงูู (Enable Iran-only mode - Strict):**
       *   ููู ฺุฒ (TCP ู UDP) ููุท ุจุฑุง ุงุฑุงู ุจุงุฒ ุงุณุช.
       *   ุงููุช ุจุงูุงุชุฑ ูู ููฺฉู ุงุณุช ุงุชุตุงู ุงููู ุณุฎุชโุชุฑ ุดูุฏ.
   
   > **ูพุดููุงุฏ:** ุนุฏุฏ **`1`** ุฑุง ูุงุฑุฏ ฺฉุฑุฏู ู Enter ุจุฒูุฏ.

ด. **ุชุดุฎุต ูพูุฑุชโูุง (Port Detection):**
   ุงุณฺฉุฑูพุช ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ฺฉุงูุชูุฑูุง ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ.
   *   **ุญุงูุช ุงูู (ุชุดุฎุต ูููู):**
       > **Prompt:** `Use detected ports? (y/n):`
       >
       > **ูพุงุณุฎ:** **`y`** (ุงฺฏุฑ ูพูุฑุชโูุง ุตุญุญ ูุณุชูุฏ)

   *   **ุญุงูุช ุฏูู (ุนุฏู ุชุดุฎุต / Host Networking):**
       ุงฺฏุฑ ูพูุฑุชโูุง ูพุฏุง ูุดุฏูุฏ ุง ุดูุง `n` ุฒุฏุฏ:
       > **Prompt:** `Enter Conduit port(s) [or Enter for all]:`
       >
       > **ูพุงุณุฎ:** ุงฺฏุฑ ูพูุฑุช ุฏูู ุฑุง ููโุฏุงูุฏุ ููุท **Enter** ุจุฒูุฏ.
       >
       > **Prompt:** `Are you sure? (yes/no):`
       >
       > **ูพุงุณุฎ:** **`yes`**
       > *ูฺฉุชู:* ุงูุชุฎุงุจ "All ports" ุฏุฑ ุฏุงฺฉุฑ ุฑู ุดุจฺฉู Host ุงููโุชุฑ ุงุณุช ุชุง ูุทูุฆู ุดูุฏ ุชุฑุงูฺฉ ูุณุฏูุฏ ูโุดูุฏ.

ด. **ูุชุฌู ููุง:**
   ูพุณ ุงุฒ ูุนุงูโุณุงุฒุ ูพุงู `โ IRAN-ONLY MODE ENABLED!` ููุงุด ุฏุงุฏู ูโุดูุฏ.
   *   **TCP:** ููู ุฏูุง (ุจุฑุง ุงุชุตุงู ุจู ุจุฑูฺฉุฑ ุณุงููู)
   *   **UDP:** ููุท ุงุฑุงู (ุชุงูุชู ุฏุชุง)
   *   **SSH ู ูุจ:** ุจุฏูู ุชุบุฑ ุจุงู ูโูุงููุฏ.

---

## ูุฑุญูู ด: ุจุฑุฑุณ ููุง (Verification)

### ฑ. ุจุฑุฑุณ ูุงุฑูุงู
ุงุจุชุฏุง ูุถุนุช ูุงุฑูุงู ุฑุง ฺฺฉ ฺฉูุฏ:
```bash
cd /opt/conduit-firewall
sudo ./check_status.sh
```
ุงฺฏุฑ ูพุงู **`โ IRAN-ONLY MODE ENABLED`** ุฑุง ุฏุฏุฏุ ูุงุฑูุงู ูุนุงู ุงุณุช.

### ฒ. ุจุฑุฑุณ ุนููฺฉุฑุฏ ฺฉุงูุงู (Conduit Verification)
ุจุฑุง ุงุทููุงู ุงุฒ ุณุงูู ุจูุฏู ูุฑูโุงูุฒุงุฑ ู ุงุชุตุงู ฺฉุงุฑุจุฑุงู:

ฑ. ุฏุณุชูุฑ ุฒุฑ ุฑุง ุจุฑุง ุจุงุฒ ฺฉุฑุฏู ููู ูุฏุฑุช ุงุฌุฑุง ฺฉูุฏ:
   ```bash
   conduit
   ```

ฒ. **ูุดุงูุฏู ุขูุงุฑ (Stats):**
   ฺฏุฒูู **`1`** ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ ุชุง ุฏุงุดุจูุฑุฏ ูุถุนุช ุจุงุฒ ุดูุฏ.

ณ. **ูุดุงูุฏู ุชุฑุงูฺฉ ฺฉุงุฑุจุฑุงู (Live traffic):**
   ฺฏุฒูู **`4`** (Live peers) ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.
   *   *ูฺฉุชู ููู:* ููฺฉู ุงุณุช ุฏูุงู (ุง ุญุช ุชุง ฑ ุณุงุนุช) ุทูู ุจฺฉุดุฏ ุชุง ฺฉุงุฑุจุฑุงู ูุงูุน ุจู ุณุฑูุฑ ุดูุง ูุชุตู ุดููุฏ. ุตุจูุฑ ุจุงุดุฏ.

ด. **ุชุณุช ุณูุงูุช (Health Check):**
   ุงุฒ ููู ุงุตู:
   *   ุนุฏุฏ **`9`** (Settings) ุฑุง ุจุฒูุฏ.
   *   ุณูพุณ ุนุฏุฏ **`5`** (Health Check) ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ.
   *   ุงฺฏุฑ ููู ููุงุฑุฏ ุณุจุฒ ุจูุฏ (`OK`)ุ ุณุฑูุฑ ุดูุง ุขูุงุฏู ุงุณุช.

---
**ูฺฉุชู ุงููุช:** ุงู ูุงุฑูุงู ุทูุฑ ุทุฑุงุญ ุดุฏู ฺฉู ุชุฑุงูฺฉ TCP (ูุงููุฏ SSH) ุฑุง ูุทุน ููโฺฉูุฏุ ูพุณ ูฺฏุฑุงู ูุทุน ุฏุณุชุฑุณ ุฎูุฏ ูุจุงุดุฏ. ููุท ุชุฑุงูฺฉ UDP (ุชุฑุงูฺฉ ุงุตู ฺฉุงุฑุจุฑุงู) ูุญุฏูุฏ ุจู ุงุฑุงู ูโุดูุฏ.
